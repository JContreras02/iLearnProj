<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>iLearn - Course Catalog</title>
    <link rel="stylesheet" href="assets/courses.css" />
    <link rel="icon" type="image/x-icon" href="./assets/logo-icon.png" />
  </head>
  <body>
    <nav class="navbar">
      <a href="index.html" style="text-decoration: none">
        <div class="logo">
          <img src="assets/logo-icon.png" alt="iLearn Logo" class="logo-img" />
          iLearn
        </div>
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="courses.html">Courses</a>
        <a href="about.html">About</a>
      </div>
      <div class="auth-buttons">
        <a href="signin.html" class="btn btn-login">Login</a>
        <a href="signup.html" class="btn btn-signup">Signup</a>
      </div>
    </nav>

    <section class="search-section">
      <div class="search-container">
        <div class="search-box">
          <input
            type="text"
            class="search-input"
            placeholder="Search for courses..."
          />
          <button class="search-btn">Search</button>
        </div>
      </div>
    </section>

    <div class="main-content">
      <aside class="filters">
        <div class="filter-section">
          <h3 class="filter-title">Categories</h3>
          <div class="filter-option">
            <input type="checkbox" id="web-dev" />
            <label for="web-dev">Web Development</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="data-science" />
            <label for="data-science">Data Science</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="design" />
            <label for="design">Design</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="business" />
            <label for="business">Business</label>
          </div>
        </div>

        <div class="filter-section">
          <h3 class="filter-title">Level</h3>
          <div class="filter-option">
            <input type="checkbox" id="beginner" />
            <label for="beginner">Beginner</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="intermediate" />
            <label for="intermediate">Intermediate</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="advanced" />
            <label for="advanced">Advanced</label>
          </div>
        </div>

        <div class="filter-section">
          <h3 class="filter-title">Price</h3>
          <div class="filter-option">
            <input type="checkbox" id="free" />
            <label for="free">Free</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="paid" />
            <label for="paid">Paid</label>
          </div>
        </div>
      </aside>

      <main class="courses-container">
        <div class="courses-header">
          <div class="courses-count">Showing 0 courses</div>
          <select class="sort-select">
            <option value="popular">Most Popular</option>
            <option value="newest">Newest</option>
            <option value="price-low">Price: Low to High</option>
            <option value="price-high">Price: High to Low</option>
          </select>
        </div>

        <div class="courses-grid">
          <!-- Course cards will be loaded dynamically by JavaScript -->
          <div class="loading">Loading courses...</div>
        </div>
      </main>
    </div>

    <!-- Include our catalog integration JavaScript -->
    <script src="scripts/courses.js"></script>
    <!-- Add this at the bottom of your courses.html file -->
    <script>
      // Force update enroll buttons
      (function () {
        // Function to directly modify the enroll buttons
        function forceUpdateEnrollButtons() {
          // Get enrolled courses from localStorage
          let enrolledCourses = [];
          try {
            enrolledCourses =
              JSON.parse(localStorage.getItem("enrolledCourses")) || [];
            console.log("Enrolled courses:", enrolledCourses);
          } catch (e) {
            console.error("Error parsing enrolled courses:", e);
            return;
          }

          // If no enrolled courses, exit
          if (!enrolledCourses.length) {
            console.log("No enrolled courses found");
            return;
          }

          // Get all buttons with "Enroll Now" text
          const buttons = Array.from(
            document.querySelectorAll("button")
          ).filter((btn) => btn.textContent.trim() === "Enroll Now");

          console.log("Found", buttons.length, "enroll buttons");

          // For each button, try to find its course ID
          buttons.forEach((button) => {
            // Try different ways to find the course ID
            let courseId = null;

            // Check for data-id attribute
            if (button.hasAttribute("data-id")) {
              courseId = button.getAttribute("data-id");
            }

            // Check for onclick attribute
            if (!courseId && button.hasAttribute("onclick")) {
              const onclickText = button.getAttribute("onclick");
              const match = onclickText.match(
                /enrollCourse\s*\(\s*['"]([^'"]+)['"]/
              );
              if (match && match[1]) {
                courseId = match[1];
              }
            }

            // Check if parent element has a data-id
            if (!courseId) {
              let parent = button.parentElement;
              while (parent && !courseId) {
                if (parent.hasAttribute("data-id")) {
                  courseId = parent.getAttribute("data-id");
                  break;
                }
                parent = parent.parentElement;
              }
            }

            // Try to find the course title if all else fails
            if (!courseId) {
              // Look for the course title in nearby elements
              const card =
                button.closest(".course-card") ||
                button.closest('[class*="course"]');
              if (card) {
                const titleElement =
                  card.querySelector("h3") ||
                  card.querySelector(".course-title");
                if (titleElement) {
                  const title = titleElement.textContent.trim();
                  // Check if any enrolled course has this title
                  const matchingCourse = enrolledCourses.find(
                    (course) => course.title === title || course.name === title
                  );
                  if (matchingCourse) {
                    courseId = matchingCourse.id;
                  }
                }
              }
            }

            console.log("Button:", button, "CourseId:", courseId);

            // If course ID found, check if enrolled
            if (courseId) {
              const isEnrolled = enrolledCourses.some(
                (course) => course.id === courseId
              );

              if (isEnrolled) {
                console.log("Updating button for enrolled course:", courseId);

                // Update button styling and text
                button.textContent = "Already Enrolled";
                button.disabled = true;
                button.style.backgroundColor = "#94a3b8";
                button.style.cursor = "not-allowed";
                button.style.opacity = "0.7";

                // Remove onclick handler
                button.removeAttribute("onclick");

                // Add custom CSS class
                button.classList.add("already-enrolled");

                // Add a new click handler for good measure
                button.addEventListener("click", function (e) {
                  e.preventDefault();
                  e.stopPropagation();
                  alert("You are already enrolled in this course");
                  return false;
                });
              }
            }
          });
        }

        // Add some delay to make sure everything is loaded
        setTimeout(forceUpdateEnrollButtons, 1000);

        // Also run after scrolling or clicking, in case of dynamic content
        window.addEventListener("scroll", function () {
          setTimeout(forceUpdateEnrollButtons, 200);
        });

        document.addEventListener("click", function () {
          setTimeout(forceUpdateEnrollButtons, 200);
        });

        // Add CSS for the already enrolled button
        const style = document.createElement("style");
        style.textContent = `
      .already-enrolled, button.already-enrolled {
        background-color: #94a3b8 !important;
        color: white !important;
        cursor: not-allowed !important;
        opacity: 0.7 !important;
        pointer-events: none !important;
      }
      
      .already-enrolled:hover, button.already-enrolled:hover {
        background-color: #94a3b8 !important;
        transform: none !important;
        box-shadow: none !important;
      }
    `;
        document.head.appendChild(style);
      })();
    </script>
  </body>
</html>
